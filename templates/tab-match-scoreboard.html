
{{$infos:= .General.PlayerInfos}}


<style type="text/css" media="screen">
.wrapper {
	display: flex;
	width:100%;
}

.scoretable tr {
	line-height: 10px;
	padding: 5px;
}

.scoretable td {
	line-height: 10px;
	padding: 5px;
}


.wrapped {
	flex-basis: 100%;
}

.scoretable {
  table-layout: fixed ;
  width: 100% ;
}

.scoretablenum{
	width: 30px;
	text-align: center;
}

th span {
  transform-origin: 0 50%;
  transform: rotate(-90deg); 
  white-space: nowrap; 
  display: block;
  left: 50%;
}

#chartcontainer-match-players {
	height: 300px;
}


</style>

<div  id="chartcontainer-match-players"></div>

<script charset="utf-8">
	Highcharts.chart('chartcontainer-match-players', {
    chart: {
        type: 'column'
    },
    title:  null,
    xAxis: {

        categories: [
		{{range $p := .Scoreboard.TeamClan}} {{$player:= index $infos .PlayerSteamID64}}
		'{{$player.Name}}',
		{{end}} {{range $p := .Scoreboard.TeamEnemy}} {{$player:= index $infos .PlayerSteamID64}}
		'{{$player.Name}}',
		{{end}}
        ],
        crosshair: true
    },
    yAxis: {
        min: 0,
        title: null,
    },
    tooltip: {
        headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
        pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
            '<td style="padding:0"><b>{point.y:.1f} HP</b></td></tr>',
        footerFormat: '</table>',
        shared: true,
        useHTML: true
    },
    plotOptions: {
        column: {
            pointPadding: 0.1,
            borderWidth: 0
        }
    },
    series: [

	{
        name: 'Kills',
        data: [
		{{range $p := .Scoreboard.TeamClan}}
		'{{$p.Kills}}',
		{{end}} {{range $p := .Scoreboard.TeamEnemy}}
		'{{$p.Kills}}',
		{{end}}
		]
    },
	{
        name: 'Deaths',
        data: [
		{{range $p := .Scoreboard.TeamClan}} 
		'{{$p.Deaths}}',
		{{end}} {{range $p := .Scoreboard.TeamEnemy}}
		'{{$p.Deaths}}',
		{{end}}
		]
    },
	{
        name: 'Assists',
        data: [
		{{range $p := .Scoreboard.TeamClan}}
		'{{$p.Assists}}',
		{{end}} {{range $p := .Scoreboard.TeamEnemy}}
		'{{$p.Assists}}',
		{{end}}
		]
    },
	]
});
</script>




<script charset="utf-8">
	$(document).ready(function(){
	$('.collapsible').collapsible();
  });
</script>
<table id="scoretableClan" class="scoretable highlight blue-grey lighten-5">
	<thead>
		<tr>
			<th style="width:40px;"></th>
			<th style="width:140px;"></th>
			<th style="width:80px;"></th>
			<th class="scoretablenum">K</th>
			<th class="scoretablenum">D</th>
			<th class="scoretablenum">A</th>
			<th class="scoretablenum">+/-</th>
			<th class="scoretablenum">K/D</th>
			<th class="scoretablenum">ADR</th>
			<th class="scoretablenum">HS</th>
			<th class="scoretablenum">FK</th>
			<th class="scoretablenum">FD</th>
			<th class="scoretablenum">K</th>
			<th class="scoretablenum">D</th>
			<th class="scoretablenum">FK</th>
			<th class="scoretablenum">FD</th>
			<th class="scoretablenum">1v5</th>
			<th class="scoretablenum">1v4</th>
			<th class="scoretablenum">1v3</th>
			<th class="scoretablenum">5k</th>
			<th class="scoretablenum">4k</th>
			<th class="scoretablenum">3k</th>
		</tr>
	</thead>
	<tbody>



		{{range $p := .Scoreboard.TeamClan}}
		{{$player:= index $infos .PlayerSteamID64}}
		<tr>
			<td> <img class="tableimage" src="{{ $player.AvatarURL }}" alt=""></img> </td>
			<td>{{$player.Name}}<div class="orange-text">{{ $player.ClanTag }}</div></td>
			<td> <img class="tableimage" src="{{ $player.RankIconURL }}" alt=""></img></td>
			<td class="scoretablenum">{{ $p.Kills }}</td>
			<td class="scoretablenum">{{ $p.Deaths }}</td>
			<td class="scoretablenum">{{ $p.Assists }}</td>
			<td class="scoretablenum">{{ $p.KDDiff }}</td>
			<td class="scoretablenum">{{ $p.KD }}</td>
			<td class="scoretablenum">{{ $p.ADR }}</td>
			<td class="scoretablenum">{{ $p.HSPrecent }}</td>
			<td class="scoretablenum">{{ $p.FirstKills }}</td>
			<td class="scoretablenum">{{ $p.FirstDeaths }}</td>
			<td class="scoretablenum">{{ $p.TradeKills }}</td>
			<td class="scoretablenum">{{ $p.TradeDeaths }}</td>
			<td class="scoretablenum">{{ $p.TradeFirstKills }}</td>
			<td class="scoretablenum">{{ $p.TradeFirstDeaths }}</td>
			<td class="scoretablenum">{{ $p.RoundsWonV5 }}</td>
			<td class="scoretablenum">{{ $p.RoundsWonV4 }}</td>
			<td class="scoretablenum">{{ $p.RoundsWonV3 }}</td>
			<td class="scoretablenum">{{ $p.Rounds5k }}</td>
			<td class="scoretablenum">{{ $p.Rounds4k }}</td>
			<td class="scoretablenum">{{ $p.Rounds3k }}</td>
		</tr>
		{{end}}
	</tbody>
	<th></th>
</table>

<table id="scoretableEnemy" class="scoretable highlight blue-grey lighten-5">
	<thead>
		<tr>
			<th style="width:40px;"></th>
			<th style="width:140px;"></th>
			<th style="width:80px;"></th>
			<th class="scoretablenum">K</th>
			<th class="scoretablenum">D</th>
			<th class="scoretablenum">A</th>
			<th class="scoretablenum">+/-</th>
			<th class="scoretablenum">K/D</th>
			<th class="scoretablenum">ADR</th>
			<th class="scoretablenum">HS</th>
			<th class="scoretablenum">FK</th>
			<th class="scoretablenum">FD</th>
			<th class="scoretablenum">K</th>
			<th class="scoretablenum">D</th>
			<th class="scoretablenum">FK</th>
			<th class="scoretablenum">FD</th>
			<th class="scoretablenum">1v5</th>
			<th class="scoretablenum">1v4</th>
			<th class="scoretablenum">1v3</th>
			<th class="scoretablenum">5k</th>
			<th class="scoretablenum">4k</th>
			<th class="scoretablenum">3k</th>
		</tr>
	</thead>
	<tbody>
	</tbody>
</table>

<script id="matchScoreboardTemplate" type="text/x-jquery-tmpl">
		<tr>
			<td> <img class="tableimage" src="${avatar_url}" alt=""></img> </td>
			<td>${name}<div class="orange-text">${clantag}</div></td>
			<td> <img class="tableimage" src="/public/img/ranks/${rank}.png" alt="{$rank}"></img></td>
			<td class="scoretablenum">${kills}</td>
			<td class="scoretablenum">${deaths}</td>
			<td class="scoretablenum">${assists}</td>
			<td class="scoretablenum">${kddiff}</td>
			<td class="scoretablenum">${kd}</td>
			<td class="scoretablenum">${adr}</td>
			<td class="scoretablenum">${hsprecent}</td>
			<td class="scoretablenum">${firstkills}</td>
			<td class="scoretablenum">${firstdeaths}</td>
			<td class="scoretablenum">${tradekills}</td>
			<td class="scoretablenum">${tradedeaths}</td>
			<td class="scoretablenum">${tradefirstkills}</td>
			<td class="scoretablenum">${tradefirstdeaths}</td>
			<td class="scoretablenum">${roundswonv5}</td>
			<td class="scoretablenum">${roundswonv4}</td>
			<td class="scoretablenum">${roundswonv3}</td>
			<td class="scoretablenum">${rounds5k}</td>
			<td class="scoretablenum">${rounds4k}</td>
			<td class="scoretablenum">${rounds3k}</td>
		</tr>
</script>


<script charset="utf-8">

$(document).ready(function(){

	// TODO use correct id
	var url = "/api/matchinfo/1/scoreboard"
	$.getJSON(url,  function( data) {

		//data.sort((a, b) => b.shots - a.shots)

		for (var row = 0; row < data.clan.length; row++) {
			$( "#matchScoreboardTemplate" ).tmpl(data.clan[row]).appendTo( "#scoretableClan tbody" );
		}


		for (var row = 0; row < data.enemy.length; row++) {
			$( "#matchScoreboardTemplate" ).tmpl(data.enemy[row]).appendTo( "#scoretableEnemy tbody" );
		}
	});
});

</script>
